<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://apps.bdimg.com/libs/jquerymobile/1.4.5/jquery.mobile-1.4.5.min.css">
		<script src="https://apps.bdimg.com/libs/jquery/1.10.2/jquery.min.js"></script>
		<script src="https://apps.bdimg.com/libs/jquerymobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
		<link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
		<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<script src="js/jquery.cookie.js"></script>
		<style>
			.orderclass {
				color: red;
			}
		</style>

		<script>
			var fid;
			var secretid_ck = $.cookie('secretid'); // 读取 cookie
			$(function() {

				//var flighttime = "07/22 Wednesday";
				var d = new Date();

				$("#flighttime").html(formatDate2(d) + " " + getWeekDate());

				$.ajax({
					url: "http://47.92.31.116:8888/flight/flight",
					type: 'post', //提交的方式
					async: false,
					error: function(request) { //失败的话
						//$.messager.alert('ERROR', 'Connection error');
					},
					success: function(result) {
						if(result == "") {

						} else {
							for(i = 0; i < result.length; i++) {
								var flight = result[i];
								var airline = flight.airline;

								var departureTime = formatDate(flight.departureTime);
								var departureCity = flight.departureCity;

								var arrivalTime = formatDate(flight.arrivalTime);
								var arrivalCity = flight.arrivalCity;

								var airFare = flight.airFare;

								$("#flight").append(
									"<div onclick='selectOrder(this," + flight.flightid + ");'>" +
									"<div class=\"row\" style=\"font-size: 22px;margin-top:10px\">" +
									"<div>" + airline + "</div>" +
									"<div id=\"flightid\" style=\"display:none\"></div>" +
									"</div>" +

									"<div class=\"row\" style=\"font-size: 22px;width: 100%; \">" +
									"<div style=\"float: left;width: 20%;\">" +
									"<div>" + departureTime + "</div>" +
									"<div>" + departureCity + "</div>" +
									"</div>" +

									"<div style=\"float: left;width: 30%;height:35px;border-bottom: 3px solid blue;\"></div>" +
									"<div style=\"float: left;width: 30%; \">" +
									"<div>" + arrivalTime + "</div>" +
									"<div>" + arrivalCity + "</div>" +
									"</div>" +
									"<div style=\"float: left;width: 20%;font-size: 18px;text-align: right;\">" +
									"<div>$" + airFare + "</div>" +
									"<div>economy class</div>" +
									"</div>" +
									"</div>" +
									"<div class=\"row \" style=\"font-size: 22px; margin-top:10px;border-bottom: 1px solid black;\"></div>" +
									"</div>"
								);

							}
						}
					}

				});

				$("#order").click(function() {
					if(secretid_ck == 0) {
						window.location.href = "index.html";
					}
					$.ajax({
						url: "http://47.92.31.116:8888/flightorder/order",
						type: 'post', //提交的方式
						async: false,
						data: {
							secretid: secretid_ck,
							flightid: fid
						},
						success: function(result) {
							if(result == 1) {
								$("#msg").text("You have successfully booked your flight");
								$('#show').trigger("click");
							}

						}
					});

					//alert(fid);

				});

			});

			function selectOrder(input, flightid) {
				fid = flightid;
				var sliblings = sibling(input);
				for(i = 0; i < sliblings.length; i++) {
					sliblings[i].style.color = 'black';
				}
				input.style.color = 'red';

			}

			function sibling(elm) {
				var a = [];
				var p = elm.parentNode.children;
				for(var i = 0, pl = p.length; i < pl; i++) {
					if(p[i] !== elm) a.push(p[i]);
				}
				return a;
			}

			function formatDate(value) {

				var date = new Date(value);
				var year = date.getFullYear().toString();
				var month = (date.getMonth() + 1);
				var day = date.getDate().toString();
				var hour = date.getHours().toString();
				var minutes = date.getMinutes().toString();
				var seconds = date.getSeconds().toString();
				if(month < 10) {
					month = "0" + month;
				}
				if(day < 10) {
					day = "0" + day;
				}
				if(hour < 10) {
					hour = "0" + hour;
				}
				if(minutes < 10) {
					minutes = "0" + minutes;
				}
				if(seconds < 10) {
					seconds = "0" + seconds;
				}

				return hour + ":" + minutes;

			}

			function formatDate2(value) {

				var date = new Date(value);
				var year = date.getFullYear().toString();
				var month = (date.getMonth() + 1);
				var day = date.getDate().toString();
				var hour = date.getHours().toString();
				var minutes = date.getMinutes().toString();
				var seconds = date.getSeconds().toString();
				if(month < 10) {
					month = "0" + month;
				}
				if(day < 10) {
					day = "0" + day;
				}
				if(hour < 10) {
					hour = "0" + hour;
				}
				if(minutes < 10) {
					minutes = "0" + minutes;
				}
				if(seconds < 10) {
					seconds = "0" + seconds;
				}

				return month + "/" + day;

			}

			function getWeekDate() {
				var now = new Date();
				var day = now.getDay();
				var weeks = new Array("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saterday");
				var week = weeks[day];
				return week;
			}
		</script>
	</head>

	<body style="background-color: #fffefe;">

		<a id="show" href="#myPopup1" data-rel="popup" class="ui-btn ui-btn-inline ui-corner-all" data-position-to="window" style="display:none"></a>

		<div data-role="popup" id="myPopup1" class="ui-content" data-overlay-theme="b" data-transition="flip">
			<p id="msg"></p>
		</div>

		<div style="margin-bottom:20px;">
			<div style="background:#709bd0;height:100px">
				<div>
					<div style="text-align: center;font-size: 18px; ">Flight home page</div>
				</div>
				<div id="flighttime" style="font-size: 22px;margin-top: 25px; ">

				</div>
			</div>
		</div>

		<div id="flight" class="container-fluid" style="margin: 0 25px;">

		</div>
		<div style="position:fixed;background-color:aquamarine; height:60px;width:100%;bottom:0px;">
			<div id="" style="width: 100%;font-size: 22px;text-align: center;margin-top: 10px;">
				<div id="home" style="width: 33%; float:left;" onclick="window.location.href = 'index.html'">Home</div>
				<div id="order" style="width: 34%; float:left;">Place Order</div>
				<div id="myorder" style="width: 33%; float:left;" onclick="window.location.href = 'myorder.html'">My order</div>
			</div>

		</div>
	</body>

</html>